{% extends 'base.html' %}

{% block title %}Tokens - {{ company.name }}{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
	<h1 class="text-2xl font-semibold">Tokens de Acesso - {{ company.name }}</h1>
	<form method="post" action="{% url 'company_token_create' company.id %}">
		{% csrf_token %}
		<input type="text" name="label" placeholder="Rótulo (opcional)" class="mr-2 flex w-64 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2" />
		<button class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:opacity-90">Gerar</button>
	</form>
</div>

<div class="glass-effect rounded-xl border border-border/40 overflow-hidden">
	<table class="min-w-full">
		<thead class="text-left text-sm text-muted-foreground border-b border-border/40">
			<tr>
				<th class="py-3 px-4">Rótulo</th>
				<th class="py-3 px-4">JTI</th>
				<th class="py-3 px-4">Criado em</th>
				<th class="py-3 px-4">Status</th>
				<th class="py-3 px-4"></th>
			</tr>
		</thead>
		<tbody class="divide-y divide-border/40">
			{% for t in tokens %}
			<tr>
				<td class="py-3 px-4">{{ t.label|default:'—' }}</td>
				<td class="py-3 px-4 font-mono text-xs">{{ t.refresh_jti }}</td>
				<td class="py-3 px-4">{{ t.created_at }}</td>
				<td class="py-3 px-4">{% if t.revoked_at %}<span class="text-red-400">Revogado</span>{% else %}<span class="text-green-400">Ativo</span>{% endif %}</td>
				<td class="py-3 px-4 text-right">
					{% if not t.revoked_at %}
					<form method="post" action="{% url 'company_token_revoke' company.id t.id %}">
						{% csrf_token %}
						<button class="px-3 py-1 text-sm rounded bg-destructive text-destructive-foreground hover:opacity-90">Revogar</button>
					</form>
					{% endif %}
				</td>
			</tr>
			{% empty %}
			<tr>
				<td colspan="5" class="py-6 px-4 text-center text-muted-foreground">Nenhum token gerado ainda.</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
{% endblock %}

