{% extends 'base.html' %}

{% block title %}Pesquisas{% endblock %}

{% block content %}
<div class="mb-6 flex items-center justify-between">
	<h1 class="text-2xl font-semibold">Pesquisas</h1>
	<div class="flex items-center gap-3">
		{% include 'components/_page_size.html' with current_page_size=page_size %}
		<a href="{% url 'survey_create' %}" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:opacity-90">Nova Pesquisa</a>
	</div>
</div>

<div class="glass-effect rounded-xl border border-border/40 overflow-hidden">
	<table class="min-w-full">
		<thead class="text-left text-sm text-muted-foreground border-b border-border/40">
			<tr>
				<th class="py-3 px-4">Título</th>
				<th class="py-3 px-4">Empresa</th>
				<th class="py-3 px-4">Token</th>
				<th class="py-3 px-4">Criado em</th>
				<th class="py-3 px-4"></th>
			</tr>
		</thead>
		<tbody class="divide-y divide-border/40">
			{% for survey in surveys %}
			<tr>
				<td class="py-3 px-4 font-medium">{{ survey.title }}</td>
				<td class="py-3 px-4">{{ survey.company.name }}</td>
				<td class="py-3 px-4">
					<div class="flex items-center gap-2">
						<span class="font-mono tracking-wider">{{ survey.token }}</span>
						<button type="button" class="copy-token px-2 py-1 text-xs rounded border border-border hover:bg-accent" data-token="{{ survey.token }}" title="Copiar">
							<i data-lucide="copy" class="w-4 h-4"></i>
						</button>
					</div>
				</td>
				<td class="py-3 px-4">{{ survey.created_at }}</td>
				<td class="py-3 px-4 text-right space-x-3">
					<a href="{% url 'survey_detail' survey.id %}" class="text-primary hover:underline">Ver</a>
					<a href="{% url 'survey_update' survey.id %}" class="text-blue-400 hover:underline">Editar</a>
					<a href="{% url 'survey_delete' survey.id %}" class="text-red-400 hover:underline">Excluir</a>
					<a href="{% url 'survey_preview' survey.token %}" class="text-green-600 hover:underline">Responder</a>
				</td>
			</tr>
			{% empty %}
			<tr>
				<td colspan="5" class="py-6 px-4 text-center text-muted-foreground">Nenhuma pesquisa criada.</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>

<script>
document.addEventListener('DOMContentLoaded', function() {
	const buttons = document.querySelectorAll('.copy-token');
	buttons.forEach(btn => {
		btn.addEventListener('click', async function() {
			const token = this.getAttribute('data-token');
			try {
				await navigator.clipboard.writeText(token);
				const note = document.createElement('div');
				note.className = 'fixed top-4 right-4 bg-green-600/90 text-white px-3 py-2 rounded-md shadow z-50';
				note.textContent = 'Token copiado';
				document.body.appendChild(note);
				setTimeout(() => { note.style.opacity = '0'; setTimeout(() => note.remove(), 200); }, 1200);
			} catch (e) {
				alert('Não foi possível copiar o token');
			}
		});
	});
});
</script>
</div>
{% include 'components/_pagination.html' with page_obj=page_obj %}
{% endblock %}

