<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Dashboard - {{ survey.title }}</title>
  <style>
    body { font-family: DejaVu Sans, Arial, sans-serif; font-size: 12px; color: #111; }
    h1 { font-size: 20px; margin: 0 0 6px 0; }
    h2 { font-size: 14px; margin: 16px 0 6px 0; }
    p.meta { margin: 0 0 2px 0; color: #444; }
    .summary { margin: 10px 0 14px 0; padding: 8px; border: 1px solid #ddd; }
    table { width: 100%; border-collapse: collapse; margin-top: 6px; }
    th, td { border: 1px solid #ddd; padding: 6px; }
    th { background: #f2f2f2; text-align: left; }
    .muted { color: #666; }
  </style>
</head>
<body>
  <h1>Dashboard de Respostas</h1>
  <p class="meta"><strong>Pesquisa:</strong> {{ survey.title }}</p>
  <p class="meta"><strong>Empresa:</strong> {{ survey.company.name }} | <strong>Token:</strong> {{ survey.token }}</p>

  <div class="summary">
    <p><strong>Total de Respostas:</strong> {{ total_submissions }}</p>
    <p><strong>Última Resposta:</strong> {{ last_submission.submitted_at|default:'—' }}</p>
  </div>

  <h2>Mapa de calor das submissões</h2>
  {% if heat_grid.max > 0 %}
  <table style="table-layout: fixed; width: 100%; border: none;">
    <tbody>
      {% for row in heat_grid.rows %}
      <tr>
        {% for cell in row %}
        <td style="padding: 4px; border: 1px solid #eee;">
          <div style="width: 100%; height: 12px; background: {{ cell.color }};"></div>
        </td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <p class="muted">Intensidade baseada em concentração relativa de pontos (branco → vermelho).</p>
  {% else %}
  <p class="muted">Sem coordenadas para exibir o mapa de calor.</p>
  {% endif %}

  {% for dist in distributions %}
    <h2>{{ forloop.counter }}. {{ dist.question.question_text }}</h2>
    <table>
      <thead>
        <tr>
          <th>Opção</th>
          <th>Respostas</th>
        </tr>
      </thead>
      <tbody>
        {% for o in dist.options %}
          <tr>
            <td>{{ o.selected_option__option_text }}</td>
            <td>{{ o.total }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="2" class="muted">Sem respostas</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endfor %}
</body>
</html>


